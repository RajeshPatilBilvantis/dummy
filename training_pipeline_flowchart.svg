<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: %3 Pages: 1 -->
<svg width="167pt" height="2304pt"
 viewBox="0.00 0.00 167.47 2304.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.45 0.45) rotate(0) translate(36 5068)">
<title>%3</title>
<polygon fill="white" stroke="transparent" points="-36,36 -36,-5068 335,-5068 335,36 -36,36"/>
<!-- source -->
<g id="node1" class="node">
<title>source</title>
<path fill="#e8f4f8" stroke="black" d="M287,-5032C287,-5032 12,-5032 12,-5032 6,-5032 0,-5026 0,-5020 0,-5020 0,-4952 0,-4952 0,-4946 6,-4940 12,-4940 12,-4940 287,-4940 287,-4940 293,-4940 299,-4946 299,-4952 299,-4952 299,-5020 299,-5020 299,-5026 293,-5032 287,-5032"/>
<text text-anchor="middle" x="149.5" y="-4996.6" font-family="Arial" font-size="13.00">Source Table</text>
<text text-anchor="middle" x="149.5" y="-4982.6" font-family="Arial" font-size="13.00">dl_tenants_daas.us_wealth_management</text>
<text text-anchor="middle" x="149.5" y="-4968.6" font-family="Arial" font-size="13.00">.wealth_management_client_metrics</text>
</g>
<!-- load -->
<g id="node2" class="node">
<title>load</title>
<path fill="#fff4e6" stroke="black" d="M215.5,-4856C215.5,-4856 83.5,-4856 83.5,-4856 77.5,-4856 71.5,-4850 71.5,-4844 71.5,-4844 71.5,-4776 71.5,-4776 71.5,-4770 77.5,-4764 83.5,-4764 83.5,-4764 215.5,-4764 215.5,-4764 221.5,-4764 227.5,-4770 227.5,-4776 227.5,-4776 227.5,-4844 227.5,-4844 227.5,-4850 221.5,-4856 215.5,-4856"/>
<text text-anchor="middle" x="149.5" y="-4820.6" font-family="Arial" font-size="13.00">Load Data</text>
<text text-anchor="middle" x="149.5" y="-4806.6" font-family="Arial" font-size="13.00">Spark DataFrame</text>
<text text-anchor="middle" x="149.5" y="-4792.6" font-family="Arial" font-size="13.00">df_raw</text>
</g>
<!-- source&#45;&gt;load -->
<g id="edge1" class="edge">
<title>source&#45;&gt;load</title>
<path fill="none" stroke="black" d="M149.5,-4939.74C149.5,-4917.28 149.5,-4889.97 149.5,-4866.28"/>
<polygon fill="black" stroke="black" points="153,-4866.04 149.5,-4856.04 146,-4866.04 153,-4866.04"/>
<text text-anchor="middle" x="187.5" y="-4895.2" font-family="Arial" font-size="11.00">Load from table</text>
</g>
<!-- transform -->
<g id="node3" class="node">
<title>transform</title>
<path fill="#fff4e6" stroke="black" d="M264.5,-4680C264.5,-4680 34.5,-4680 34.5,-4680 28.5,-4680 22.5,-4674 22.5,-4668 22.5,-4668 22.5,-4586 22.5,-4586 22.5,-4580 28.5,-4574 34.5,-4574 34.5,-4574 264.5,-4574 264.5,-4574 270.5,-4574 276.5,-4580 276.5,-4586 276.5,-4586 276.5,-4668 276.5,-4668 276.5,-4674 270.5,-4680 264.5,-4680"/>
<text text-anchor="middle" x="149.5" y="-4644.6" font-family="Arial" font-size="13.00">Product Category Transformation</text>
<text text-anchor="middle" x="149.5" y="-4630.6" font-family="Arial" font-size="13.00">prod_lob + sub_product_level_1/2</text>
<text text-anchor="middle" x="149.5" y="-4616.6" font-family="Arial" font-size="13.00">→ product_category</text>
<text text-anchor="middle" x="149.5" y="-4602.6" font-family="Arial" font-size="13.00">(7 categories)</text>
</g>
<!-- load&#45;&gt;transform -->
<g id="edge2" class="edge">
<title>load&#45;&gt;transform</title>
<path fill="none" stroke="black" d="M149.5,-4763.79C149.5,-4741.62 149.5,-4714.56 149.5,-4690.45"/>
<polygon fill="black" stroke="black" points="153,-4690.32 149.5,-4680.32 146,-4690.32 153,-4690.32"/>
<text text-anchor="middle" x="174" y="-4719.2" font-family="Arial" font-size="11.00">Transform</text>
</g>
<!-- filter1 -->
<g id="node4" class="node">
<title>filter1</title>
<path fill="#fff4e6" stroke="black" d="M253.5,-4490C253.5,-4490 45.5,-4490 45.5,-4490 39.5,-4490 33.5,-4484 33.5,-4478 33.5,-4478 33.5,-4396 33.5,-4396 33.5,-4390 39.5,-4384 45.5,-4384 45.5,-4384 253.5,-4384 253.5,-4384 259.5,-4384 265.5,-4390 265.5,-4396 265.5,-4396 265.5,-4478 265.5,-4478 265.5,-4484 259.5,-4490 253.5,-4490"/>
<text text-anchor="middle" x="149.5" y="-4454.6" font-family="Arial" font-size="13.00">Filter Required Fields</text>
<text text-anchor="middle" x="149.5" y="-4440.6" font-family="Arial" font-size="13.00">• cont_id NOT NULL</text>
<text text-anchor="middle" x="149.5" y="-4426.6" font-family="Arial" font-size="13.00">• register_date NOT NULL</text>
<text text-anchor="middle" x="149.5" y="-4412.6" font-family="Arial" font-size="13.00">• product_category NOT NULL</text>
</g>
<!-- transform&#45;&gt;filter1 -->
<g id="edge3" class="edge">
<title>transform&#45;&gt;filter1</title>
<path fill="none" stroke="black" d="M149.5,-4573.63C149.5,-4550.92 149.5,-4524.14 149.5,-4500.4"/>
<polygon fill="black" stroke="black" points="153,-4500.09 149.5,-4490.09 146,-4500.09 153,-4500.09"/>
<text text-anchor="middle" x="162" y="-4529.2" font-family="Arial" font-size="11.00">Filter</text>
</g>
<!-- filter2 -->
<g id="node5" class="node">
<title>filter2</title>
<path fill="#fff4e6" stroke="black" d="M232,-4300C232,-4300 67,-4300 67,-4300 61,-4300 55,-4294 55,-4288 55,-4288 55,-4234 55,-4234 55,-4228 61,-4222 67,-4222 67,-4222 232,-4222 232,-4222 238,-4222 244,-4228 244,-4234 244,-4234 244,-4288 244,-4288 244,-4294 238,-4300 232,-4300"/>
<text text-anchor="middle" x="149.5" y="-4264.6" font-family="Arial" font-size="13.00">Filter Active Policies</text>
<text text-anchor="middle" x="149.5" y="-4250.6" font-family="Arial" font-size="13.00">policy_status = &quot;Active&quot;</text>
</g>
<!-- filter1&#45;&gt;filter2 -->
<g id="edge4" class="edge">
<title>filter1&#45;&gt;filter2</title>
<path fill="none" stroke="black" d="M149.5,-4383.79C149.5,-4360.44 149.5,-4333.09 149.5,-4310.22"/>
<polygon fill="black" stroke="black" points="153,-4310.07 149.5,-4300.07 146,-4310.07 153,-4310.07"/>
<text text-anchor="middle" x="175.5" y="-4339.2" font-family="Arial" font-size="11.00">Active only</text>
</g>
<!-- sample -->
<g id="node6" class="node">
<title>sample</title>
<path fill="#fff4e6" stroke="black" d="M244,-4138C244,-4138 55,-4138 55,-4138 49,-4138 43,-4132 43,-4126 43,-4126 43,-4072 43,-4072 43,-4066 49,-4060 55,-4060 55,-4060 244,-4060 244,-4060 250,-4060 256,-4066 256,-4072 256,-4072 256,-4126 256,-4126 256,-4132 250,-4138 244,-4138"/>
<text text-anchor="middle" x="149.5" y="-4102.6" font-family="Arial" font-size="13.00">Sample Fraction: 0.2 (20%)</text>
<text text-anchor="middle" x="149.5" y="-4088.6" font-family="Arial" font-size="13.00">Seed: 42</text>
</g>
<!-- filter2&#45;&gt;sample -->
<g id="edge5" class="edge">
<title>filter2&#45;&gt;sample</title>
<path fill="none" stroke="black" d="M149.5,-4221.68C149.5,-4199.61 149.5,-4171.67 149.5,-4148.14"/>
<polygon fill="black" stroke="black" points="153,-4148.01 149.5,-4138.01 146,-4148.01 153,-4148.01"/>
<text text-anchor="middle" x="188.5" y="-4177.2" font-family="Arial" font-size="11.00">Optional sample</text>
</g>
<!-- order -->
<g id="node7" class="node">
<title>order</title>
<path fill="#fff4e6" stroke="black" d="M248.5,-3976C248.5,-3976 50.5,-3976 50.5,-3976 44.5,-3976 38.5,-3970 38.5,-3964 38.5,-3964 38.5,-3882 38.5,-3882 38.5,-3876 44.5,-3870 50.5,-3870 50.5,-3870 248.5,-3870 248.5,-3870 254.5,-3870 260.5,-3876 260.5,-3882 260.5,-3882 260.5,-3964 260.5,-3964 260.5,-3970 254.5,-3976 248.5,-3976"/>
<text text-anchor="middle" x="149.5" y="-3940.6" font-family="Arial" font-size="13.00">Order Events by Date</text>
<text text-anchor="middle" x="149.5" y="-3926.6" font-family="Arial" font-size="13.00">Window: partitionBy(cont_id)</text>
<text text-anchor="middle" x="149.5" y="-3912.6" font-family="Arial" font-size="13.00">orderBy(register_ts)</text>
<text text-anchor="middle" x="149.5" y="-3898.6" font-family="Arial" font-size="13.00">Add event_idx</text>
</g>
<!-- sample&#45;&gt;order -->
<g id="edge6" class="edge">
<title>sample&#45;&gt;order</title>
<path fill="none" stroke="black" d="M149.5,-4059.81C149.5,-4038.37 149.5,-4011.07 149.5,-3986.58"/>
<polygon fill="black" stroke="black" points="153,-3986.29 149.5,-3976.29 146,-3986.29 153,-3986.29"/>
<text text-anchor="middle" x="181" y="-4015.2" font-family="Arial" font-size="11.00">Order events</text>
</g>
<!-- vocab -->
<g id="node8" class="node">
<title>vocab</title>
<path fill="#e8f5e9" stroke="black" d="M264,-3786C264,-3786 35,-3786 35,-3786 29,-3786 23,-3780 23,-3774 23,-3774 23,-3678 23,-3678 23,-3672 29,-3666 35,-3666 35,-3666 264,-3666 264,-3666 270,-3666 276,-3672 276,-3678 276,-3678 276,-3774 276,-3774 276,-3780 270,-3786 264,-3786"/>
<text text-anchor="middle" x="149.5" y="-3750.6" font-family="Arial" font-size="13.00">Build Product Vocabulary</text>
<text text-anchor="middle" x="149.5" y="-3736.6" font-family="Arial" font-size="13.00">• Extract unique product_category</text>
<text text-anchor="middle" x="149.5" y="-3722.6" font-family="Arial" font-size="13.00">• Create prod2id mapping</text>
<text text-anchor="middle" x="149.5" y="-3708.6" font-family="Arial" font-size="13.00">• Create id2prod mapping</text>
<text text-anchor="middle" x="149.5" y="-3694.6" font-family="Arial" font-size="13.00">Vocabulary Size: 7</text>
</g>
<!-- order&#45;&gt;vocab -->
<g id="edge7" class="edge">
<title>order&#45;&gt;vocab</title>
<path fill="none" stroke="black" d="M149.5,-3870C149.5,-3847.39 149.5,-3820.58 149.5,-3796.31"/>
<polygon fill="black" stroke="black" points="153,-3796.09 149.5,-3786.09 146,-3796.09 153,-3796.09"/>
<text text-anchor="middle" x="177.5" y="-3825.2" font-family="Arial" font-size="11.00">Build vocab</text>
</g>
<!-- group -->
<g id="node9" class="node">
<title>group</title>
<path fill="#e8f5e9" stroke="black" d="M232,-3582C232,-3582 67,-3582 67,-3582 61,-3582 55,-3576 55,-3570 55,-3570 55,-3502 55,-3502 55,-3496 61,-3490 67,-3490 67,-3490 232,-3490 232,-3490 238,-3490 244,-3496 244,-3502 244,-3502 244,-3570 244,-3570 244,-3576 238,-3582 232,-3582"/>
<text text-anchor="middle" x="149.5" y="-3546.6" font-family="Arial" font-size="13.00">Group Events by Client</text>
<text text-anchor="middle" x="149.5" y="-3532.6" font-family="Arial" font-size="13.00">Group by cont_id</text>
<text text-anchor="middle" x="149.5" y="-3518.6" font-family="Arial" font-size="13.00">Sort by event_idx</text>
</g>
<!-- vocab&#45;&gt;group -->
<g id="edge8" class="edge">
<title>vocab&#45;&gt;group</title>
<path fill="none" stroke="black" d="M149.5,-3665.77C149.5,-3642.35 149.5,-3615.56 149.5,-3592.51"/>
<polygon fill="black" stroke="black" points="153,-3592.21 149.5,-3582.21 146,-3592.21 153,-3592.21"/>
<text text-anchor="middle" x="186" y="-3621.2" font-family="Arial" font-size="11.00">Group by client</text>
</g>
<!-- dedupe -->
<g id="node10" class="node">
<title>dedupe</title>
<path fill="#e8f5e9" stroke="black" d="M260,-3406C260,-3406 39,-3406 39,-3406 33,-3406 27,-3400 27,-3394 27,-3394 27,-3326 27,-3326 27,-3320 33,-3314 39,-3314 39,-3314 260,-3314 260,-3314 266,-3314 272,-3320 272,-3326 272,-3326 272,-3394 272,-3394 272,-3400 266,-3406 260,-3406"/>
<text text-anchor="middle" x="149.5" y="-3370.6" font-family="Arial" font-size="13.00">Remove Consecutive Duplicates</text>
<text text-anchor="middle" x="149.5" y="-3356.6" font-family="Arial" font-size="13.00">Focus on product transitions</text>
<text text-anchor="middle" x="149.5" y="-3342.6" font-family="Arial" font-size="13.00">Example: [A,A,B] → [A,B]</text>
</g>
<!-- group&#45;&gt;dedupe -->
<g id="edge9" class="edge">
<title>group&#45;&gt;dedupe</title>
<path fill="none" stroke="black" d="M149.5,-3489.74C149.5,-3467.28 149.5,-3439.97 149.5,-3416.28"/>
<polygon fill="black" stroke="black" points="153,-3416.04 149.5,-3406.04 146,-3416.04 153,-3416.04"/>
<text text-anchor="middle" x="178.5" y="-3445.2" font-family="Arial" font-size="11.00">Deduplicate</text>
</g>
<!-- filter3 -->
<g id="node11" class="node">
<title>filter3</title>
<path fill="#e8f5e9" stroke="black" d="M250.5,-3230C250.5,-3230 48.5,-3230 48.5,-3230 42.5,-3230 36.5,-3224 36.5,-3218 36.5,-3218 36.5,-3164 36.5,-3164 36.5,-3158 42.5,-3152 48.5,-3152 48.5,-3152 250.5,-3152 250.5,-3152 256.5,-3152 262.5,-3158 262.5,-3164 262.5,-3164 262.5,-3218 262.5,-3218 262.5,-3224 256.5,-3230 250.5,-3230"/>
<text text-anchor="middle" x="149.5" y="-3194.6" font-family="Arial" font-size="13.00">Filter: MIN_EVENTS ≥ 2</text>
<text text-anchor="middle" x="149.5" y="-3180.6" font-family="Arial" font-size="13.00">Keep clients with ≥2 products</text>
</g>
<!-- dedupe&#45;&gt;filter3 -->
<g id="edge10" class="edge">
<title>dedupe&#45;&gt;filter3</title>
<path fill="none" stroke="black" d="M149.5,-3313.81C149.5,-3291.11 149.5,-3263.58 149.5,-3240.45"/>
<polygon fill="black" stroke="black" points="153,-3240.16 149.5,-3230.16 146,-3240.16 153,-3240.16"/>
<text text-anchor="middle" x="189" y="-3269.2" font-family="Arial" font-size="11.00">Filter min events</text>
</g>
<!-- sliding -->
<g id="node12" class="node">
<title>sliding</title>
<path fill="#e8f5e9" stroke="black" d="M239.5,-3068C239.5,-3068 59.5,-3068 59.5,-3068 53.5,-3068 47.5,-3062 47.5,-3056 47.5,-3056 47.5,-2974 47.5,-2974 47.5,-2968 53.5,-2962 59.5,-2962 59.5,-2962 239.5,-2962 239.5,-2962 245.5,-2962 251.5,-2968 251.5,-2974 251.5,-2974 251.5,-3056 251.5,-3056 251.5,-3062 245.5,-3068 239.5,-3068"/>
<text text-anchor="middle" x="149.5" y="-3032.6" font-family="Arial" font-size="13.00">Sliding Window Examples</text>
<text text-anchor="middle" x="149.5" y="-3018.6" font-family="Arial" font-size="13.00">For each position i:</text>
<text text-anchor="middle" x="149.5" y="-3004.6" font-family="Arial" font-size="13.00">• History: products[0:i]</text>
<text text-anchor="middle" x="149.5" y="-2990.6" font-family="Arial" font-size="13.00">• Label: products[i]</text>
</g>
<!-- filter3&#45;&gt;sliding -->
<g id="edge11" class="edge">
<title>filter3&#45;&gt;sliding</title>
<path fill="none" stroke="black" d="M149.5,-3151.81C149.5,-3130.37 149.5,-3103.07 149.5,-3078.58"/>
<polygon fill="black" stroke="black" points="153,-3078.29 149.5,-3068.29 146,-3078.29 153,-3078.29"/>
<text text-anchor="middle" x="190.5" y="-3107.2" font-family="Arial" font-size="11.00">Create examples</text>
</g>
<!-- hist_feat -->
<g id="node13" class="node">
<title>hist_feat</title>
<path fill="#e8f5e9" stroke="black" d="M255.5,-2878C255.5,-2878 43.5,-2878 43.5,-2878 37.5,-2878 31.5,-2872 31.5,-2866 31.5,-2866 31.5,-2756 31.5,-2756 31.5,-2750 37.5,-2744 43.5,-2744 43.5,-2744 255.5,-2744 255.5,-2744 261.5,-2744 267.5,-2750 267.5,-2756 267.5,-2756 267.5,-2866 267.5,-2866 267.5,-2872 261.5,-2878 255.5,-2878"/>
<text text-anchor="middle" x="149.5" y="-2842.6" font-family="Arial" font-size="13.00">History&#45;Derived Features</text>
<text text-anchor="middle" x="149.5" y="-2828.6" font-family="Arial" font-size="13.00">• seq_len: history length</text>
<text text-anchor="middle" x="149.5" y="-2814.6" font-family="Arial" font-size="13.00">• last_1: most recent product</text>
<text text-anchor="middle" x="149.5" y="-2800.6" font-family="Arial" font-size="13.00">• last_2: second recent product</text>
<text text-anchor="middle" x="149.5" y="-2786.6" font-family="Arial" font-size="13.00">• unique_prior: unique count</text>
<text text-anchor="middle" x="149.5" y="-2772.6" font-family="Arial" font-size="13.00">• num_switches: transitions</text>
</g>
<!-- sliding&#45;&gt;hist_feat -->
<g id="edge12" class="edge">
<title>sliding&#45;&gt;hist_feat</title>
<path fill="none" stroke="black" d="M149.5,-2961.98C149.5,-2939.58 149.5,-2912.94 149.5,-2888.38"/>
<polygon fill="black" stroke="black" points="153,-2888.36 149.5,-2878.36 146,-2888.36 153,-2888.36"/>
<text text-anchor="middle" x="193" y="-2917.2" font-family="Arial" font-size="11.00">Compute features</text>
</g>
<!-- freq_feat -->
<g id="node14" class="node">
<title>freq_feat</title>
<path fill="#e8f5e9" stroke="black" d="M244.5,-2660C244.5,-2660 54.5,-2660 54.5,-2660 48.5,-2660 42.5,-2654 42.5,-2648 42.5,-2648 42.5,-2566 42.5,-2566 42.5,-2560 48.5,-2554 54.5,-2554 54.5,-2554 244.5,-2554 244.5,-2554 250.5,-2554 256.5,-2560 256.5,-2566 256.5,-2566 256.5,-2648 256.5,-2648 256.5,-2654 250.5,-2660 244.5,-2660"/>
<text text-anchor="middle" x="149.5" y="-2624.6" font-family="Arial" font-size="13.00">Frequency Features</text>
<text text-anchor="middle" x="149.5" y="-2610.6" font-family="Arial" font-size="13.00">freq_1 to freq_7</text>
<text text-anchor="middle" x="149.5" y="-2596.6" font-family="Arial" font-size="13.00">Count per product category</text>
<text text-anchor="middle" x="149.5" y="-2582.6" font-family="Arial" font-size="13.00">in history sequence</text>
</g>
<!-- hist_feat&#45;&gt;freq_feat -->
<g id="edge13" class="edge">
<title>hist_feat&#45;&gt;freq_feat</title>
<path fill="none" stroke="black" d="M149.5,-2743.86C149.5,-2720.2 149.5,-2693.64 149.5,-2670.32"/>
<polygon fill="black" stroke="black" points="153,-2670.2 149.5,-2660.2 146,-2670.2 153,-2670.2"/>
<text text-anchor="middle" x="175.5" y="-2699.2" font-family="Arial" font-size="11.00">Frequency</text>
</g>
<!-- pad_hist -->
<g id="node15" class="node">
<title>pad_hist</title>
<path fill="#e8f5e9" stroke="black" d="M230.5,-2470C230.5,-2470 68.5,-2470 68.5,-2470 62.5,-2470 56.5,-2464 56.5,-2458 56.5,-2458 56.5,-2376 56.5,-2376 56.5,-2370 62.5,-2364 68.5,-2364 68.5,-2364 230.5,-2364 230.5,-2364 236.5,-2364 242.5,-2370 242.5,-2376 242.5,-2376 242.5,-2458 242.5,-2458 242.5,-2464 236.5,-2470 230.5,-2470"/>
<text text-anchor="middle" x="149.5" y="-2434.6" font-family="Arial" font-size="13.00">Pad History Sequence</text>
<text text-anchor="middle" x="149.5" y="-2420.6" font-family="Arial" font-size="13.00">MAX_SEQ_LEN = 10</text>
<text text-anchor="middle" x="149.5" y="-2406.6" font-family="Arial" font-size="13.00">Left&#45;pad with 0</text>
<text text-anchor="middle" x="149.5" y="-2392.6" font-family="Arial" font-size="13.00">Create hist_0 to hist_9</text>
</g>
<!-- freq_feat&#45;&gt;pad_hist -->
<g id="edge14" class="edge">
<title>freq_feat&#45;&gt;pad_hist</title>
<path fill="none" stroke="black" d="M149.5,-2553.63C149.5,-2530.92 149.5,-2504.14 149.5,-2480.4"/>
<polygon fill="black" stroke="black" points="153,-2480.09 149.5,-2470.09 146,-2480.09 153,-2480.09"/>
<text text-anchor="middle" x="177" y="-2509.2" font-family="Arial" font-size="11.00">Pad history</text>
</g>
<!-- static -->
<g id="node16" class="node">
<title>static</title>
<path fill="#e8f5e9" stroke="black" d="M264.5,-2280C264.5,-2280 34.5,-2280 34.5,-2280 28.5,-2280 22.5,-2274 22.5,-2268 22.5,-2268 22.5,-2172 22.5,-2172 22.5,-2166 28.5,-2160 34.5,-2160 34.5,-2160 264.5,-2160 264.5,-2160 270.5,-2160 276.5,-2166 276.5,-2172 276.5,-2172 276.5,-2268 276.5,-2268 276.5,-2274 270.5,-2280 264.5,-2280"/>
<text text-anchor="middle" x="149.5" y="-2244.6" font-family="Arial" font-size="13.00">Join Static Features</text>
<text text-anchor="middle" x="149.5" y="-2230.6" font-family="Arial" font-size="13.00">Most recent client snapshot:</text>
<text text-anchor="middle" x="149.5" y="-2216.6" font-family="Arial" font-size="13.00">• Financial: acct_val, assets, etc.</text>
<text text-anchor="middle" x="149.5" y="-2202.6" font-family="Arial" font-size="13.00">• Demographics: age, segments</text>
<text text-anchor="middle" x="149.5" y="-2188.6" font-family="Arial" font-size="13.00">• Channel: channel, agent, branch</text>
</g>
<!-- pad_hist&#45;&gt;static -->
<g id="edge15" class="edge">
<title>pad_hist&#45;&gt;static</title>
<path fill="none" stroke="black" d="M149.5,-2364C149.5,-2341.39 149.5,-2314.58 149.5,-2290.31"/>
<polygon fill="black" stroke="black" points="153,-2290.09 149.5,-2280.09 146,-2290.09 153,-2290.09"/>
<text text-anchor="middle" x="173.5" y="-2319.2" font-family="Arial" font-size="11.00">Join static</text>
</g>
<!-- missing -->
<g id="node17" class="node">
<title>missing</title>
<path fill="#e8f5e9" stroke="black" d="M243.5,-2076C243.5,-2076 55.5,-2076 55.5,-2076 49.5,-2076 43.5,-2070 43.5,-2064 43.5,-2064 43.5,-1982 43.5,-1982 43.5,-1976 49.5,-1970 55.5,-1970 55.5,-1970 243.5,-1970 243.5,-1970 249.5,-1970 255.5,-1976 255.5,-1982 255.5,-1982 255.5,-2064 255.5,-2064 255.5,-2070 249.5,-2076 243.5,-2076"/>
<text text-anchor="middle" x="149.5" y="-2040.6" font-family="Arial" font-size="13.00">Handle Missing Values</text>
<text text-anchor="middle" x="149.5" y="-2026.6" font-family="Arial" font-size="13.00">• Numeric: fill with 0</text>
<text text-anchor="middle" x="149.5" y="-2012.6" font-family="Arial" font-size="13.00">• Categorical: fill with mode</text>
<text text-anchor="middle" x="149.5" y="-1998.6" font-family="Arial" font-size="13.00">• Default: &quot;UNKNOWN&quot;</text>
</g>
<!-- static&#45;&gt;missing -->
<g id="edge16" class="edge">
<title>static&#45;&gt;missing</title>
<path fill="none" stroke="black" d="M149.5,-2159.96C149.5,-2136.72 149.5,-2110.01 149.5,-2086.45"/>
<polygon fill="black" stroke="black" points="153,-2086.22 149.5,-2076.22 146,-2086.22 153,-2086.22"/>
<text text-anchor="middle" x="176" y="-2115.2" font-family="Arial" font-size="11.00">Fill missing</text>
</g>
<!-- encode -->
<g id="node18" class="node">
<title>encode</title>
<path fill="#e8f5e9" stroke="black" d="M250,-1886C250,-1886 49,-1886 49,-1886 43,-1886 37,-1880 37,-1874 37,-1874 37,-1792 37,-1792 37,-1786 43,-1780 49,-1780 49,-1780 250,-1780 250,-1780 256,-1780 262,-1786 262,-1792 262,-1792 262,-1874 262,-1874 262,-1880 256,-1886 250,-1886"/>
<text text-anchor="middle" x="149.5" y="-1850.6" font-family="Arial" font-size="13.00">Encode Categorical Features</text>
<text text-anchor="middle" x="149.5" y="-1836.6" font-family="Arial" font-size="13.00">Convert strings to indices</text>
<text text-anchor="middle" x="149.5" y="-1822.6" font-family="Arial" font-size="13.00">Create _idx columns</text>
<text text-anchor="middle" x="149.5" y="-1808.6" font-family="Arial" font-size="13.00">6 categorical features</text>
</g>
<!-- missing&#45;&gt;encode -->
<g id="edge17" class="edge">
<title>missing&#45;&gt;encode</title>
<path fill="none" stroke="black" d="M149.5,-1969.63C149.5,-1946.92 149.5,-1920.14 149.5,-1896.4"/>
<polygon fill="black" stroke="black" points="153,-1896.09 149.5,-1886.09 146,-1896.09 153,-1896.09"/>
<text text-anchor="middle" x="168" y="-1925.2" font-family="Arial" font-size="11.00">Encode</text>
</g>
<!-- final_feat -->
<g id="node19" class="node">
<title>final_feat</title>
<path fill="#e8f5e9" stroke="black" d="M228,-1696C228,-1696 71,-1696 71,-1696 65,-1696 59,-1690 59,-1684 59,-1684 59,-1546 59,-1546 59,-1540 65,-1534 71,-1534 71,-1534 228,-1534 228,-1534 234,-1534 240,-1540 240,-1546 240,-1546 240,-1684 240,-1684 240,-1690 234,-1696 228,-1696"/>
<text text-anchor="middle" x="149.5" y="-1660.6" font-family="Arial" font-size="13.00">Final Feature Set</text>
<text text-anchor="middle" x="149.5" y="-1646.6" font-family="Arial" font-size="13.00">Total: 39 features</text>
<text text-anchor="middle" x="149.5" y="-1632.6" font-family="Arial" font-size="13.00">• 10 history (hist_0&#45;9)</text>
<text text-anchor="middle" x="149.5" y="-1618.6" font-family="Arial" font-size="13.00">• 5 sequence stats</text>
<text text-anchor="middle" x="149.5" y="-1604.6" font-family="Arial" font-size="13.00">• 7 frequency</text>
<text text-anchor="middle" x="149.5" y="-1590.6" font-family="Arial" font-size="13.00">• 11 financial</text>
<text text-anchor="middle" x="149.5" y="-1576.6" font-family="Arial" font-size="13.00">• 1 demographic</text>
<text text-anchor="middle" x="149.5" y="-1562.6" font-family="Arial" font-size="13.00">• 6 categorical indices</text>
</g>
<!-- encode&#45;&gt;final_feat -->
<g id="edge18" class="edge">
<title>encode&#45;&gt;final_feat</title>
<path fill="none" stroke="black" d="M149.5,-1779.99C149.5,-1757.93 149.5,-1731.58 149.5,-1706.51"/>
<polygon fill="black" stroke="black" points="153,-1706.24 149.5,-1696.24 146,-1706.24 153,-1706.24"/>
<text text-anchor="middle" x="182.5" y="-1735.2" font-family="Arial" font-size="11.00">Final features</text>
</g>
<!-- split -->
<g id="node20" class="node">
<title>split</title>
<path fill="#fff4e6" stroke="black" d="M235,-1450C235,-1450 64,-1450 64,-1450 58,-1450 52,-1444 52,-1438 52,-1438 52,-1342 52,-1342 52,-1336 58,-1330 64,-1330 64,-1330 235,-1330 235,-1330 241,-1330 247,-1336 247,-1342 247,-1342 247,-1438 247,-1438 247,-1444 241,-1450 235,-1450"/>
<text text-anchor="middle" x="149.5" y="-1414.6" font-family="Arial" font-size="13.00">Train/Val/Test Split</text>
<text text-anchor="middle" x="149.5" y="-1400.6" font-family="Arial" font-size="13.00">Random Split (seed=42)</text>
<text text-anchor="middle" x="149.5" y="-1386.6" font-family="Arial" font-size="13.00">• Train: 80% (~464K)</text>
<text text-anchor="middle" x="149.5" y="-1372.6" font-family="Arial" font-size="13.00">• Val: 10% (~58K)</text>
<text text-anchor="middle" x="149.5" y="-1358.6" font-family="Arial" font-size="13.00">• Test: 10% (~58K)</text>
</g>
<!-- final_feat&#45;&gt;split -->
<g id="edge19" class="edge">
<title>final_feat&#45;&gt;split</title>
<path fill="none" stroke="black" d="M149.5,-1533.81C149.5,-1509.77 149.5,-1483.62 149.5,-1460.34"/>
<polygon fill="black" stroke="black" points="153,-1460.21 149.5,-1450.21 146,-1460.21 153,-1460.21"/>
<text text-anchor="middle" x="172.5" y="-1489.2" font-family="Arial" font-size="11.00">Split data</text>
</g>
<!-- convert -->
<g id="node21" class="node">
<title>convert</title>
<path fill="#fff4e6" stroke="black" d="M248.5,-1246C248.5,-1246 50.5,-1246 50.5,-1246 44.5,-1246 38.5,-1240 38.5,-1234 38.5,-1234 38.5,-1166 38.5,-1166 38.5,-1160 44.5,-1154 50.5,-1154 50.5,-1154 248.5,-1154 248.5,-1154 254.5,-1154 260.5,-1160 260.5,-1166 260.5,-1166 260.5,-1234 260.5,-1234 260.5,-1240 254.5,-1246 248.5,-1246"/>
<text text-anchor="middle" x="149.5" y="-1210.6" font-family="Arial" font-size="13.00">Convert to Pandas</text>
<text text-anchor="middle" x="149.5" y="-1196.6" font-family="Arial" font-size="13.00">Spark → Pandas DataFrame</text>
<text text-anchor="middle" x="149.5" y="-1182.6" font-family="Arial" font-size="13.00">Cache before conversion</text>
</g>
<!-- split&#45;&gt;convert -->
<g id="edge20" class="edge">
<title>split&#45;&gt;convert</title>
<path fill="none" stroke="black" d="M149.5,-1329.77C149.5,-1306.35 149.5,-1279.56 149.5,-1256.51"/>
<polygon fill="black" stroke="black" points="153,-1256.21 149.5,-1246.21 146,-1256.21 153,-1256.21"/>
<text text-anchor="middle" x="186" y="-1285.2" font-family="Arial" font-size="11.00">Convert format</text>
</g>
<!-- label_map -->
<g id="node22" class="node">
<title>label_map</title>
<path fill="#fff4e6" stroke="black" d="M226,-1070C226,-1070 73,-1070 73,-1070 67,-1070 61,-1064 61,-1058 61,-1058 61,-976 61,-976 61,-970 67,-964 73,-964 73,-964 226,-964 226,-964 232,-964 238,-970 238,-976 238,-976 238,-1058 238,-1058 238,-1064 232,-1070 226,-1070"/>
<text text-anchor="middle" x="149.5" y="-1034.6" font-family="Arial" font-size="13.00">Remap Labels</text>
<text text-anchor="middle" x="149.5" y="-1020.6" font-family="Arial" font-size="13.00">Product IDs (1&#45;7)</text>
<text text-anchor="middle" x="149.5" y="-1006.6" font-family="Arial" font-size="13.00">→ Zero&#45;based (0&#45;6)</text>
<text text-anchor="middle" x="149.5" y="-992.6" font-family="Arial" font-size="13.00">Create label0 column</text>
</g>
<!-- convert&#45;&gt;label_map -->
<g id="edge21" class="edge">
<title>convert&#45;&gt;label_map</title>
<path fill="none" stroke="black" d="M149.5,-1153.79C149.5,-1131.62 149.5,-1104.56 149.5,-1080.45"/>
<polygon fill="black" stroke="black" points="153,-1080.32 149.5,-1070.32 146,-1080.32 153,-1080.32"/>
<text text-anchor="middle" x="183" y="-1109.2" font-family="Arial" font-size="11.00">Remap labels</text>
</g>
<!-- train -->
<g id="node23" class="node">
<title>train</title>
<path fill="#f3e5f5" stroke="black" d="M229,-880C229,-880 70,-880 70,-880 64,-880 58,-874 58,-868 58,-868 58,-758 58,-758 58,-752 64,-746 70,-746 70,-746 229,-746 229,-746 235,-746 241,-752 241,-758 241,-758 241,-868 241,-868 241,-874 235,-880 229,-880"/>
<text text-anchor="middle" x="149.5" y="-844.6" font-family="Arial" font-size="13.00">Train LightGBM Model</text>
<text text-anchor="middle" x="149.5" y="-830.6" font-family="Arial" font-size="13.00">• Objective: multiclass</text>
<text text-anchor="middle" x="149.5" y="-816.6" font-family="Arial" font-size="13.00">• Classes: 7</text>
<text text-anchor="middle" x="149.5" y="-802.6" font-family="Arial" font-size="13.00">• Max rounds: 2000</text>
<text text-anchor="middle" x="149.5" y="-788.6" font-family="Arial" font-size="13.00">• Early stop: 50</text>
<text text-anchor="middle" x="149.5" y="-774.6" font-family="Arial" font-size="13.00">• Learning rate: 0.05</text>
</g>
<!-- label_map&#45;&gt;train -->
<g id="edge22" class="edge">
<title>label_map&#45;&gt;train</title>
<path fill="none" stroke="black" d="M149.5,-963.98C149.5,-941.58 149.5,-914.94 149.5,-890.38"/>
<polygon fill="black" stroke="black" points="153,-890.36 149.5,-880.36 146,-890.36 153,-890.36"/>
<text text-anchor="middle" x="178" y="-919.2" font-family="Arial" font-size="11.00">Train model</text>
</g>
<!-- eval -->
<g id="node27" class="node">
<title>eval</title>
<path fill="lightgrey" stroke="black" d="M175,-662C175,-662 124,-662 124,-662 118,-662 112,-656 112,-650 112,-650 112,-610 112,-610 112,-604 118,-598 124,-598 124,-598 175,-598 175,-598 181,-598 187,-604 187,-610 187,-610 187,-650 187,-650 187,-656 181,-662 175,-662"/>
<text text-anchor="middle" x="149.5" y="-626.6" font-family="Arial" font-size="13.00">eval</text>
</g>
<!-- train&#45;&gt;eval -->
<g id="edge23" class="edge">
<title>train&#45;&gt;eval</title>
<path fill="none" stroke="black" d="M149.5,-745.89C149.5,-721.41 149.5,-694.37 149.5,-672.67"/>
<polygon fill="black" stroke="black" points="153,-672.48 149.5,-662.48 146,-672.48 153,-672.48"/>
<text text-anchor="middle" x="171" y="-701.2" font-family="Arial" font-size="11.00">Evaluate</text>
</g>
<!-- register -->
<g id="node24" class="node">
<title>register</title>
<path fill="#ffebee" stroke="black" d="M238,-514C238,-514 61,-514 61,-514 55,-514 49,-508 49,-502 49,-502 49,-406 49,-406 49,-400 55,-394 61,-394 61,-394 238,-394 238,-394 244,-394 250,-400 250,-406 250,-406 250,-502 250,-502 250,-508 244,-514 238,-514"/>
<text text-anchor="middle" x="149.5" y="-478.6" font-family="Arial" font-size="13.00">Register Model in MLflow</text>
<text text-anchor="middle" x="149.5" y="-464.6" font-family="Arial" font-size="13.00">• Model binary</text>
<text text-anchor="middle" x="149.5" y="-450.6" font-family="Arial" font-size="13.00">• Signature</text>
<text text-anchor="middle" x="149.5" y="-436.6" font-family="Arial" font-size="13.00">• Input example</text>
<text text-anchor="middle" x="149.5" y="-422.6" font-family="Arial" font-size="13.00">• Metadata</text>
</g>
<!-- alias -->
<g id="node25" class="node">
<title>alias</title>
<path fill="#ffebee" stroke="black" d="M269.5,-310C269.5,-310 29.5,-310 29.5,-310 23.5,-310 17.5,-304 17.5,-298 17.5,-298 17.5,-230 17.5,-230 17.5,-224 23.5,-218 29.5,-218 29.5,-218 269.5,-218 269.5,-218 275.5,-218 281.5,-224 281.5,-230 281.5,-230 281.5,-298 281.5,-298 281.5,-304 275.5,-310 269.5,-310"/>
<text text-anchor="middle" x="149.5" y="-274.6" font-family="Arial" font-size="13.00">Create Model Alias</text>
<text text-anchor="middle" x="149.5" y="-260.6" font-family="Arial" font-size="13.00">Name: final_lgbm_multiclass_model</text>
<text text-anchor="middle" x="149.5" y="-246.6" font-family="Arial" font-size="13.00">Alias: lgbm_74</text>
</g>
<!-- register&#45;&gt;alias -->
<g id="edge25" class="edge">
<title>register&#45;&gt;alias</title>
<path fill="none" stroke="black" d="M149.5,-393.77C149.5,-370.35 149.5,-343.56 149.5,-320.51"/>
<polygon fill="black" stroke="black" points="153,-320.21 149.5,-310.21 146,-320.21 153,-320.21"/>
<text text-anchor="middle" x="178.5" y="-349.2" font-family="Arial" font-size="11.00">Create alias</text>
</g>
<!-- artifacts -->
<g id="node26" class="node">
<title>artifacts</title>
<path fill="#ffebee" stroke="black" d="M226,-134C226,-134 73,-134 73,-134 67,-134 61,-128 61,-122 61,-122 61,-12 61,-12 61,-6 67,0 73,0 73,0 226,0 226,0 232,0 238,-6 238,-12 238,-12 238,-122 238,-122 238,-128 232,-134 226,-134"/>
<text text-anchor="middle" x="149.5" y="-98.6" font-family="Arial" font-size="13.00">Save Artifacts</text>
<text text-anchor="middle" x="149.5" y="-84.6" font-family="Arial" font-size="13.00">artifacts.pkl contains:</text>
<text text-anchor="middle" x="149.5" y="-70.6" font-family="Arial" font-size="13.00">• prod2id, id2prod</text>
<text text-anchor="middle" x="149.5" y="-56.6" font-family="Arial" font-size="13.00">• label_map</text>
<text text-anchor="middle" x="149.5" y="-42.6" font-family="Arial" font-size="13.00">• feature_cols</text>
<text text-anchor="middle" x="149.5" y="-28.6" font-family="Arial" font-size="13.00">• max_seq_len</text>
</g>
<!-- alias&#45;&gt;artifacts -->
<g id="edge26" class="edge">
<title>alias&#45;&gt;artifacts</title>
<path fill="none" stroke="black" d="M149.5,-217.77C149.5,-195.92 149.5,-169.09 149.5,-144.21"/>
<polygon fill="black" stroke="black" points="153,-144.05 149.5,-134.05 146,-144.05 153,-144.05"/>
<text text-anchor="middle" x="182.5" y="-173.2" font-family="Arial" font-size="11.00">Save artifacts</text>
</g>
<!-- eval&#45;&gt;register -->
<g id="edge24" class="edge">
<title>eval&#45;&gt;register</title>
<path fill="none" stroke="black" d="M149.5,-597.89C149.5,-577.44 149.5,-549.84 149.5,-524.35"/>
<polygon fill="black" stroke="black" points="153,-524.34 149.5,-514.34 146,-524.34 153,-524.34"/>
<text text-anchor="middle" x="170" y="-553.2" font-family="Arial" font-size="11.00">Register</text>
</g>
</g>
</svg>
